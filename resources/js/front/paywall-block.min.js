const comfinoSettings=wc.wcSettings.getSetting("comfino_data",{});
window.Comfino={label:wp.htmlEntities.decodeEntities(comfinoSettings.title)||wp.i18n.__("Comfino payments","comfino-payment-gateway"),isSelected:!1,isPaywallActive:!1,loanParams:{loanAmount:0,loanType:"",loanTerm:0},listItemContainer:null,labelObserver:null,paywallTemplate:null,Label:()=>{Comfino.isPaywallActive=!0;return comfinoSettings.icon?wp.element.RawHTML({children:Comfino.label+'<img id="comfino-gateway-logo" src="'+comfinoSettings.icon+'" alt="'+Comfino.label+'" style="margin-left: 10px; vertical-align: bottom">'}):
label},Content:a=>{const {eventRegistration:c,emitResponse:b}=a,{onPaymentSetup:d}=c;wp.element.useEffect(()=>{const e=d(async()=>({type:b.responseTypes.SUCCESS,meta:{paymentMethodData:{comfino_loan_amount:Comfino.loanParams.loanAmount.toString(),comfino_loan_type:Comfino.loanParams.loanType,comfino_loan_term:Comfino.loanParams.loanTerm.toString()}}}));return()=>{e()}},[b.responseTypes.SUCCESS,d]);null===Comfino.paywallTemplate&&(a=(new DOMParser).parseFromString(comfinoSettings.iframeTemplate,"text/html"),
a.body.firstChild.innerHTML=ComfinoPaywallFrontend.renderPaywallIframe(comfinoSettings.paywallUrl,comfinoSettings.paywallOptions),Comfino.paywallTemplate=a.body.innerHTML,ComfinoPaywallFrontend.logEvent("Comfino paywall template initialized.","debug",a.body.firstChild));return wp.element.RawHTML({children:wp.htmlEntities.decodeEntities(Comfino.paywallTemplate)})},EditContent:()=>wp.element.RawHTML({children:"<b>[Comfino Panel]</b>"}),init:a=>{ComfinoPaywallFrontend.logEvent("Comfino.init","debug",
a);if(Comfino.isPaywallActive)if("undefined"===typeof ComfinoPaywallFrontend)console.warn("ComfinoPaywallFrontend is undefined.");else{ComfinoPaywallFrontend.logEvent("Comfino.init - initialization started.","debug");if(ComfinoPaywallFrontend.isInitialized()){if(ComfinoPaywallFrontend.logEvent("Paywall frontend already initialized.","debug",Comfino.loanParams),0<Comfino.loanParams.loanAmount){var c=parseInt(a.cartTotals.total_price);Comfino.loanParams.loanAmount!==c&&(ComfinoPaywallFrontend.logEvent("Total value changed.",
"debug",Comfino.loanParams.loanAmount,c),ComfinoPaywallFrontend.reloadPaywall())}}else{ComfinoPaywallFrontend.logEvent("Paywall frontend initialization.","debug",comfinoSettings);comfinoSettings.paywallOptions.onUpdateOrderPaymentState=b=>{ComfinoPaywallFrontend.logEvent("updateOrderPaymentState WooCommerce (Payment Blocks)","debug",b);0!==b.loanTerm&&(Comfino.loanParams.loanAmount=b.loanAmount,Comfino.loanParams.loanType=b.loanType,Comfino.loanParams.loanTerm=b.loanTerm)};c=document.getElementById("comfino-paywall-container");
if(null===c){a=document.getElementById("comfino-gateway-logo");if(null===a){ComfinoPaywallFrontend.logEvent("Comfino logo not found in the payment block.","error");return}if(null===Comfino.listItemContainer){a=ComfinoPaywallFrontend.findMatchingParentElement(a,b=>null!==b.querySelector('input[type="radio"][value="comfino"]'));if(null===a){ComfinoPaywallFrontend.logEvent("Comfino initialization input element not found in the payment block.","error");return}Comfino.listItemContainer=ComfinoPaywallFrontend.findMatchingParentElement(a,
b=>"DIV"===b.tagName)}null===Comfino.labelObserver&&(Comfino.labelObserver=new MutationObserver((b,d)=>{ComfinoPaywallFrontend.logEvent("Comfino item changed.","debug",b,d);Comfino.isSelected&&(b=document.getElementById("comfino-paywall-container"),ComfinoPaywallFrontend.logEvent("Deferred Comfino initialization started.","debug",b),ComfinoPaywallFrontend.init(null,b,comfinoSettings.paywallOptions),ComfinoPaywallFrontend.executeClickLogic())}),Comfino.labelObserver.observe(Comfino.listItemContainer,
{characterData:!0,subtree:!0,childList:!0}));return}ComfinoPaywallFrontend.init(null,c,comfinoSettings.paywallOptions)}!Comfino.isSelected&&Array.isArray(a.paymentMethods)&&1===a.paymentMethods.length&&(ComfinoPaywallFrontend.logEvent("Firefox bug workaround executed.","debug",a.paymentMethods),Comfino.isSelected="comfino"===a.paymentMethods[0])}}};
wp.hooks.addAction("experimental__woocommerce_blocks-checkout-render-checkout-form","comfino",()=>{const a=wp.data.select("wc/store/payment");ComfinoPaywallFrontend.logEvent("woocommerce_blocks-checkout-render-checkout-form","debug",a.getActivePaymentMethod(),a.getAvailablePaymentMethods(),a.getPaymentMethodData(),a.getState());Comfino.isSelected="comfino"===a.getActivePaymentMethod()});
wp.hooks.addAction("experimental__woocommerce_blocks-checkout-set-active-payment-method","comfino",a=>{ComfinoPaywallFrontend.logEvent("woocommerce_blocks-checkout-set-active-payment-method","debug",a);"comfino"===a.value?(Comfino.isSelected=!0,ComfinoPaywallFrontend.isInitialized()&&ComfinoPaywallFrontend.executeClickLogic()):Comfino.isSelected=!1});
wc.wcBlocksRegistry.registerPaymentMethod({name:"comfino",label:Object(wp.element.createElement)(Comfino.Label,null),icon:"money-alt",content:Object(wp.element.createElement)(Comfino.Content,null),edit:Object(wp.element.createElement)(Comfino.EditContent,null),canMakePayment:a=>{ComfinoPaywallFrontend.logEvent("canMakePayment","debug",a);"complete"===document.readyState?(ComfinoPaywallFrontend.logEvent("document.readyState: complete","debug"),Comfino.init(a),Comfino.isSelected&&ComfinoPaywallFrontend.executeClickLogic()):
document.addEventListener("readystatechange",()=>{ComfinoPaywallFrontend.logEvent(`document.readyState: ${document.readyState}`,"debug");"complete"===document.readyState&&(Comfino.init(a),Comfino.isSelected&&ComfinoPaywallFrontend.executeClickLogic())});return!0},ariaLabel:Comfino.label,supports:{features:comfinoSettings.supports}});
