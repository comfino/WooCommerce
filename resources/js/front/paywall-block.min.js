const comfinoSettings=wc.wcSettings.getSetting("comfino_data",{});
window.Comfino={label:wp.htmlEntities.decodeEntities(comfinoSettings.title)||wp.i18n.__("Comfino payments","comfino-payment-gateway"),isSelected:!1,isPaywallActive:!1,loanParams:{loanAmount:0,loanType:"",loanTerm:0},shippingMethods:null,listItemContainer:null,labelObserver:null,paywallTemplate:null,Label:()=>{Comfino.isPaywallActive||ComfinoPaywallFrontend.logEvent("Comfino.Label","debug",Comfino.label,comfinoSettings.icon);Comfino.isPaywallActive=!0;return comfinoSettings.icon?wp.element.RawHTML({children:Comfino.label+
'<img id="comfino-gateway-logo" src="'+comfinoSettings.icon+'" alt="'+Comfino.label+'" style="margin-left: 10px; vertical-align: bottom">'}):Comfino.label},Content:a=>{const {eventRegistration:e,emitResponse:b}=a,{onPaymentSetup:c}=e;null===Comfino.paywallTemplate&&ComfinoPaywallFrontend.logEvent("Comfino.Content","debug",a);wp.element.useEffect(()=>{const d=c(async()=>({type:b.responseTypes.SUCCESS,meta:{paymentMethodData:{comfino_loan_amount:Comfino.loanParams.loanAmount.toString(),comfino_loan_type:Comfino.loanParams.loanType,
comfino_loan_term:Comfino.loanParams.loanTerm.toString()}}}));return()=>{d()}},[b.responseTypes.SUCCESS,c]);null===Comfino.paywallTemplate&&(a=(new DOMParser).parseFromString(comfinoSettings.iframeTemplate,"text/html"),a.body.firstChild.innerHTML=ComfinoPaywallFrontend.renderPaywallIframe(comfinoSettings.paywallUrl,comfinoSettings.paywallOptions),Comfino.paywallTemplate=a.body.innerHTML,ComfinoPaywallFrontend.logEvent("Comfino paywall template initialized.","debug",a.body.firstChild));return wp.element.RawHTML({children:wp.htmlEntities.decodeEntities(Comfino.paywallTemplate)})},
EditContent:()=>wp.element.RawHTML({children:"<b>[Comfino Panel]</b>"}),init:a=>{ComfinoPaywallFrontend.logEvent("Comfino.init","debug",a);if(Comfino.isPaywallActive)if("undefined"===typeof ComfinoPaywallFrontend)console.warn("ComfinoPaywallFrontend is undefined.");else{ComfinoPaywallFrontend.logEvent("Comfino.init - initialization started.","debug");if(ComfinoPaywallFrontend.isInitialized()){if(ComfinoPaywallFrontend.logEvent("Paywall frontend already initialized.","debug",Comfino.loanParams),0<
Comfino.loanParams.loanAmount){var e=parseInt(a.cartTotals.total_price);Comfino.loanParams.loanAmount!==e&&(ComfinoPaywallFrontend.logEvent("Total value changed.","debug",Comfino.loanParams.loanAmount,e),ComfinoPaywallFrontend.reloadPaywall())}}else{ComfinoPaywallFrontend.logEvent("Paywall frontend initialization.","debug",comfinoSettings);comfinoSettings.paywallOptions.onUpdateOrderPaymentState=b=>{ComfinoPaywallFrontend.logEvent("updateOrderPaymentState WooCommerce (Payment Blocks)","debug",b);
0!==b.loanTerm&&(Comfino.loanParams.loanAmount=b.loanAmount,Comfino.loanParams.loanType=b.loanType,Comfino.loanParams.loanTerm=b.loanTerm)};e=document.getElementById("comfino-paywall-container");if(null===e){a=document.getElementById("comfino-gateway-logo");if(null===a){ComfinoPaywallFrontend.logEvent("Comfino logo not found in the payment block.","error");return}if(null===Comfino.listItemContainer){a=ComfinoPaywallFrontend.findMatchingParentElement(a,b=>null!==b.querySelector('input[type="radio"][value="comfino"]'));
if(null===a){ComfinoPaywallFrontend.logEvent("Comfino initialization input element not found in the payment block.","error");return}Comfino.listItemContainer=ComfinoPaywallFrontend.findMatchingParentElement(a,b=>"DIV"===b.tagName)}null===Comfino.labelObserver&&(Comfino.labelObserver=new MutationObserver((b,c)=>{ComfinoPaywallFrontend.logEvent("Comfino item changed.","debug",b,c);c=document.getElementById("comfino-paywall-container");if(null!==c&&"block"!==c.style.display)if(Comfino.isSelected)ComfinoPaywallFrontend.logEvent("Deferred Comfino initialization started.",
"debug",c),ComfinoPaywallFrontend.init(null,c,comfinoSettings.paywallOptions),ComfinoPaywallFrontend.executeClickLogic();else for(let d=0;d<b.length;d++){let f;f="INPUT"===b[d].target.tagName&&"radio"===b[d].target.type?b[d].target:b[d].target.querySelector('input[type="radio"]');if(null!==f&&"comfino"===f.value){Comfino.isSelected=!0;ComfinoPaywallFrontend.logEvent("Comfino item selected.","debug",f);ComfinoPaywallFrontend.logEvent("Deferred Comfino initialization started.","debug",c);ComfinoPaywallFrontend.init(null,
c,comfinoSettings.paywallOptions);ComfinoPaywallFrontend.executeClickLogic();break}}}),Comfino.labelObserver.observe(Comfino.listItemContainer,{characterData:!0,subtree:!0,childList:!0}));return}ComfinoPaywallFrontend.init(null,e,comfinoSettings.paywallOptions)}!Comfino.isSelected&&Array.isArray(a.paymentMethods)&&1===a.paymentMethods.length&&(ComfinoPaywallFrontend.logEvent("Firefox bug workaround executed.","debug",a.paymentMethods),Comfino.isSelected="comfino"===a.paymentMethods[0])}}};
wp.hooks.addAction("experimental__woocommerce_blocks-checkout-render-checkout-form","comfino",()=>{const a=wp.data.select("wc/store/payment");ComfinoPaywallFrontend.logEvent("woocommerce_blocks-checkout-render-checkout-form","debug",a.getActivePaymentMethod(),a.getAvailablePaymentMethods(),a.getPaymentMethodData(),a.getState());Comfino.isSelected="comfino"===a.getActivePaymentMethod()});
wp.hooks.addAction("experimental__woocommerce_blocks-checkout-set-active-payment-method","comfino",a=>{ComfinoPaywallFrontend.logEvent("woocommerce_blocks-checkout-set-active-payment-method","debug",a);"comfino"===a.value?(Comfino.isSelected=!0,ComfinoPaywallFrontend.isInitialized()&&ComfinoPaywallFrontend.executeClickLogic()):Comfino.isSelected=!1});
wc.wcBlocksRegistry.registerPaymentMethod({name:"comfino",label:Object(wp.element.createElement)(Comfino.Label,null),icon:"money-alt",content:Object(wp.element.createElement)(Comfino.Content,null),edit:Object(wp.element.createElement)(Comfino.EditContent,null),canMakePayment:a=>{ComfinoPaywallFrontend.logEvent("canMakePayment","debug",a);if("complete"===document.readyState){if(ComfinoPaywallFrontend.logEvent("document.readyState: complete","debug"),null===document.getElementById("comfino-paywall-container")||
null===Comfino.shippingMethods||Comfino.shippingMethods.toString()!==Object.values(a.selectedShippingMethods).toString())Comfino.init(a),Comfino.isSelected&&ComfinoPaywallFrontend.executeClickLogic()}else document.addEventListener("readystatechange",()=>{ComfinoPaywallFrontend.logEvent(`document.readyState: ${document.readyState}`,"debug");"complete"===document.readyState&&(Comfino.init(a),Comfino.isSelected&&ComfinoPaywallFrontend.executeClickLogic())});Comfino.shippingMethods=Object.values(a.selectedShippingMethods);
return!0},ariaLabel:Comfino.label,supports:{features:comfinoSettings.supports}});
